(function(c){function f(G){var k=null,F=null,P=null,q=null,m=null,p=null,D=null,s=null,Q=0,I=true,r=10,A=0.95,C=0,g=false,B=false,L={pageX:null,pageY:null},l=[];G.hooks.processOptions.push(j);G.hooks.bindEvents.push(h);function j(S,R){if(R.series.pie.show){R.grid.show=false;if(R.series.pie.label.show=="auto"){if(R.legend.show){R.series.pie.label.show=false}else{R.series.pie.label.show=true}}if(R.series.pie.radius=="auto"){if(R.series.pie.label.show){R.series.pie.radius=3/4}else{R.series.pie.radius=1}}if(R.series.pie.tilt>1){R.series.pie.tilt=1}if(R.series.pie.tilt<0){R.series.pie.tilt=0}S.hooks.processDatapoints.push(H);S.hooks.drawOverlay.push(M);S.hooks.draw.push(u)}}function h(T,S){q=S;var R=T.getOptions();if(R.series.pie.show&&R.grid.hoverable){q.unbind("mousemove").mousemove(w)}}function K(S){var T="";function R(W,X){if(!X){X=0}for(var V in W){for(var U=0;U<X;U++){T+="\t"}if(typeof W[V]=="object"){T+=""+V+":\n";R(W[V],X+1)}else{T+=""+V+": "+W[V]+"\n"}}}R(S);alert(T)}function t(T){for(var R in T){var S=parseFloat(T[R].data[0][1]);if(S){Q+=S}}}function H(U,R,S,T){if(!g){g=true;k=U.getCanvas();P=c(k).parent();m=U.getOptions();U.setData(O(U.getData()))}}function N(){C=P.children().filter(".legend").children().width();p=Math.min(k.width,k.height)/2;s=(k.height/2)+m.series.pie.offset.top;D=(k.width/2);if(m.series.pie.offset.left=="auto"){if(m.legend.position.match("w")){D+=C/2}else{D-=C/2}}else{D+=m.series.pie.offset.left}if(D<p){D=p}else{if(D>k.width-p){D=k.width-p}}}function z(S){for(var R in S){if(typeof(S[R].data)=="number"){S[R].data=[[1,S[R].data]]}else{if(typeof(S[R].data)=="undefined"||typeof(S[R].data[0])=="undefined"){if(typeof(S[R].data)!="undefined"&&typeof(S[R].data.label)!="undefined"){S[R].label=S[R].data.label}S[R].data=[[1,0]]}}}return S}function O(U){U=z(U);t(U);var T=0;var W=0;var R=m.series.pie.combine.color;var V=[];for(var S in U){U[S].data[0][1]=parseFloat(U[S].data[0][1]);if(!U[S].data[0][1]){U[S].data[0][1]=0}if(U[S].data[0][1]/Q<=m.series.pie.combine.threshold){T+=U[S].data[0][1];W++;if(!R){R=U[S].color}}else{V.push({data:[[1,U[S].data[0][1]]],color:U[S].color,label:U[S].label,angle:(U[S].data[0][1]*(Math.PI*2))/Q,percent:(U[S].data[0][1]/Q*100)})}}if(W>0){V.push({data:[[1,T]],color:R,label:m.series.pie.combine.label,angle:(T*(Math.PI*2))/Q,percent:(T/Q*100)})}return V}function u(W,U){if(!P){return}F=U;N();var X=W.getData();var T=0;while(I&&T<r){I=false;if(T>0){p*=A}T+=1;R();if(m.series.pie.tilt<=0.8){S()}V()}if(T>=r){R();P.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')}if(W.setSeries&&W.insertLegend){W.setSeries(X);W.insertLegend()}function R(){F.clearRect(0,0,k.width,k.height);P.children().filter(".pieLabel, .pieLabelBackground").remove()}function S(){var ad=5;var ac=15;var aa=10;var ab=0.02;if(m.series.pie.radius>1){var Y=m.series.pie.radius}else{var Y=p*m.series.pie.radius}if(Y>=(k.width/2)-ad||Y*m.series.pie.tilt>=(k.height/2)-ac||Y<=aa){return}F.save();F.translate(ad,ac);F.globalAlpha=ab;F.fillStyle="#000";F.translate(D,s);F.scale(1,m.series.pie.tilt);for(var Z=1;Z<=aa;Z++){F.beginPath();F.arc(0,0,Y,0,Math.PI*2,false);F.fill();Y-=Z}F.restore()}function V(){startAngle=Math.PI*m.series.pie.startAngle;if(m.series.pie.radius>1){var Y=m.series.pie.radius}else{var Y=p*m.series.pie.radius}F.save();F.translate(D,s);F.scale(1,m.series.pie.tilt);F.save();var ac=startAngle;for(var aa in X){X[aa].startAngle=ac;ab(X[aa].angle,X[aa].color,true)}F.restore();F.save();F.lineWidth=m.series.pie.stroke.width;ac=startAngle;for(var aa in X){ab(X[aa].angle,m.series.pie.stroke.color,false)}F.restore();if(m.series.pie.label.show){Z()}F.restore();function ab(af,ad,ae){if(af<=0){return}if(ae){F.fillStyle=ad}else{F.strokeStyle=ad}F.beginPath();if(af!=Math.PI*2){F.moveTo(0,0)}else{if(c.browser.msie){af-=0.0001}}F.arc(0,0,Y,ac,ac+af,false);F.closePath();ac+=af;if(ae){F.fill()}else{F.stroke()}}function Z(){var ag=startAngle;if(m.series.pie.label.radius>1){var ad=m.series.pie.label.radius}else{var ad=p*m.series.pie.label.radius}for(var af in X){if(X[af].percent>=m.series.pie.label.threshold*100){ae(X[af],ag,af)}ag+=X[af].angle}function ae(au,am,ak){if(au.data[0][1]==0){return}var ay=m.legend.labelFormatter,aw,ai=m.series.pie.label.formatter;if(ay){aw=ay(au.label,au)}else{aw=au.label}if(ai){aw=ai(aw,au)}var an=((am+au.angle)+am)/2;var at=D+Math.round(Math.cos(an)*ad);var aq=s+Math.round(Math.sin(an)*ad)*m.series.pie.tilt;var aj='<span class="pieLabel" id="pieLabel'+ak+'" style="position:absolute;top:'+aq+"px;left:"+at+'px;">'+aw+"</span>";P.append(aj);var ar=P.children("#pieLabel"+ak);var ah=(aq-ar.height()/2);var al=(at-ar.width()/2);if(m.series.pie.label.show=="border"){F.restore();F.beginPath();F.strokeStyle="#000000";F.moveTo(at,aq);if(at>(k.width/2)){var ax=k.width-ar.width();var av=aq;al=ax}else{var ax=ar.width();var av=aq;al=0}F.lineTo(ax,av);F.stroke();F.save()}ar.css("top",ah);ar.css("left",al);if(0-ah>0||0-al>0||k.height-(ah+ar.height())<0||k.width-(al+ar.width())<0){I=true}if(m.series.pie.label.background.opacity!=0){var ao=m.series.pie.label.background.color;if(ao==null){ao=au.color}var ap="top:"+ah+"px;left:"+al+"px;";c('<div class="pieLabelBackground" style="position:absolute;width:'+ar.width()+"px;height:"+ar.height()+"px;"+ap+"background-color:"+ao+';"> </div>').insertBefore(ar).css("opacity",m.series.pie.label.background.opacity)}}}}if(m.series.pie.innerRadius>0){radius=m.series.pie.radius>1?m.series.pie.radius:p*m.series.pie.radius;F.translate(D,s);F.scale(1,m.series.pie.tilt);F.save();F.beginPath();F.strokeStyle=m.series.pie.stroke.color;F.fillStyle=m.series.pie.stroke.color;F.arc(0,0,radius*m.series.pie.innerRadius,0,Math.PI*2,false);F.fill();F.closePath()}}function v(U,V){for(var W=false,T=-1,R=U.length,S=R-1;++T<R;S=T){((U[T][1]<=V[1]&&V[1]<U[S][1])||(U[S][1]<=V[1]&&V[1]<U[T][1]))&&(V[0]<(U[S][0]-U[T][0])*(V[1]-U[T][1])/(U[S][1]-U[T][1])+U[T][0])&&(W=!W)}return W}function J(T,R,S){var Y=null,aa=false,V,U,W=G.getData(),X=m.series.pie.radius>1?m.series.pie.radius:p*m.series.pie.radius;for(var V=0;V<W.length;++V){if(!S(W[V])){continue}var Z=W[V];if(Z.pie.show){F.save();F.beginPath();F.translate(D,s);F.scale(1,m.series.pie.tilt);F.moveTo(0,0);F.arc(0,0,X,Z.startAngle,Z.startAngle+Z.angle,false);F.closePath();x=T-D;y=R-s;if(F.isPointInPath){if(F.isPointInPath(x,y)){Y={datapoint:[W[V].percent,W[V].data],dataIndex:0,series:W[V],seriesIndex:V}}}else{p1X=(X*Math.cos(Z.startAngle));p1Y=(X*Math.sin(Z.startAngle));p2X=(X*Math.cos(Z.startAngle+(Z.angle/4)));p2Y=(X*Math.sin(Z.startAngle+(Z.angle/4)));p3X=(X*Math.cos(Z.startAngle+(Z.angle/2)));p3Y=(X*Math.sin(Z.startAngle+(Z.angle/2)));p4X=(X*Math.cos(Z.startAngle+(Z.angle/1.5)));p4Y=(X*Math.sin(Z.startAngle+(Z.angle/1.5)));p5X=(X*Math.cos(Z.startAngle+Z.angle));p5Y=(X*Math.sin(Z.startAngle+Z.angle));arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];if(v(arrPoly,arrPoint)){Y={datapoint:[W[V].percent,W[V].data],dataIndex:0,series:W[V],seriesIndex:V}}}F.restore()}}return Y}function w(R){if(!g){return}L.pageX=R.pageX;L.pageY=R.pageY;if(m.grid.hoverable){o("plothover",L,function(S){return S.hoverable!=false})}}function o(S,R,U){var T=G.getPlotOffset(),V=q.offset(),aa={pageX:R.pageX,pageY:R.pageY},Y=R.pageX-V.left-T.left,W=R.pageY-V.top-T.top;var ab=J(Y,W,U);if(ab){ab.pageX=R.pageX;ab.pageY=R.pageY}if(m.grid.autoHighlight){for(var X=0;X<l.length;++X){var Z=l[X];if(Z.auto==S&&!(ab&&Z.series==ab.series)){i(Z.series)}}if(ab){n(ab.series,S)}}P.trigger(S,[aa,ab])}function n(S,T){if(typeof S=="number"){S=series[S]}var R=E(S);if(R==-1){l.push({series:S,auto:T});G.triggerRedrawOverlay()}else{if(!T){l[R].auto=false}}}function i(S){if(S==null){l=[];G.triggerRedrawOverlay()}if(typeof S=="number"){S=series[S]}var R=E(S);if(R!=-1){l.splice(R,1);G.triggerRedrawOverlay()}}function E(T){for(var R=0;R<l.length;++R){var S=l[R];if(S.series==T){return R}}return -1}function M(V,W){var R=m.series.pie.radius>1?m.series.pie.radius:p*m.series.pie.radius,U,T;W.save();W.translate(D,s);for(U=0;U<l.length;++U){S(l[U].series)}W.restore();function S(X){if(X.angle<0){return}W.fillStyle=b(m.series.pie.highlight.color).scale(null,null,null,m.series.pie.highlight.opacity).toString();W.beginPath();if(X.angle!=Math.PI*2){W.moveTo(0,0)}W.arc(0,0,R,X.startAngle,X.startAngle+X.angle,false);W.closePath();W.fill()}}}function e(h,i,g){if(i<h){return h}else{if(i>g){return g}else{return i}}}function d(n,m,i,k){var l=["r","g","b","a"];var h=4;while(-1<--h){this[l[h]]=arguments[h]||((h==3)?1:0)}this.toString=function(){if(this.a>=1){return"rgb("+[this.r,this.g,this.b].join(",")+")"}else{return"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"}};this.scale=function(p,o,q,g){h=4;while(-1<--h){if(arguments[h]!=null){this[l[h]]*=arguments[h]}}return this.normalize()};this.adjust=function(p,o,q,g){h=4;while(-1<--h){if(arguments[h]!=null){this[l[h]]+=arguments[h]}}return this.normalize()};this.clone=function(){return new d(this.r,this.b,this.g,this.a)};var j=function(o,g,p){return Math.max(Math.min(o,p),g)};this.normalize=function(){this.r=e(0,parseInt(this.r),255);this.g=e(0,parseInt(this.g),255);this.b=e(0,parseInt(this.b),255);this.a=e(0,this.a,1);return this};this.normalize()}function b(i){var g;if(g=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(i)){return new d(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10))}if(g=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i)){return new d(parseInt(g[1],10),parseInt(g[2],10),parseInt(g[3],10),parseFloat(g[4]))}if(g=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(i)){return new d(parseFloat(g[1])*2.55,parseFloat(g[2])*2.55,parseFloat(g[3])*2.55)}if(g=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i)){return new d(parseFloat(g[1])*2.55,parseFloat(g[2])*2.55,parseFloat(g[3])*2.55,parseFloat(g[4]))}if(g=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(i)){return new d(parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16))}if(g=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(i)){return new d(parseInt(g[1]+g[1],16),parseInt(g[2]+g[2],16),parseInt(g[3]+g[3],16))}var h=c.trim(i).toLowerCase();if(h=="transparent"){return new d(255,255,255,0)}else{g=lookupColors[h];return new d(g[0],g[1],g[2])}}var a={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:0,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(g,h){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+h.color+';">'+g+"<br/>"+Math.round(h.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{color:"#ffee77",opacity:0.2}}}};c.plot.plugins.push({init:f,options:a,name:"pie",version:"0.4"})})(jQuery);